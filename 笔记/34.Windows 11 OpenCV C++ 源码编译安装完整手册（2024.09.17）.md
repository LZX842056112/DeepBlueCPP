# Windows 11 OpenCV C++ æºç ç¼–è¯‘å®‰è£…å®Œæ•´æ‰‹å†Œï¼ˆ2024.09.17ï¼‰

---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 å®‰è£… Visual Studio 2022

1. è®¿é—® [Visual Studio å®˜ç½‘](https://visualstudio.microsoft.com/zh-hans/)
2. ä¸‹è½½ **Visual Studio 2022 Community**
3. è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹©ä»¥ä¸‹å·¥ä½œè´Ÿè½½ï¼š

```
â˜‘ï¸ ä½¿ç”¨ C++ çš„æ¡Œé¢å¼€å‘
```

### 1.2 å®‰è£… CMake

1. è®¿é—® [CMake å®˜ç½‘](https://cmake.org/download/)
2. ä¸‹è½½ **cmake-3.28.x-windows-x86_64.msi**ï¼ˆåŒå­¦ä»¬é€‰æ‹©æœ€æ–°ç¨³å®šç‰ˆå°±å¯ä»¥äº†ï¼‰
3. è¿è¡Œå®‰è£…ç¨‹åºï¼š

```
å®‰è£…é€‰é¡¹ä¸­é€‰æ‹©ï¼š
â—‰ Add CMake to the system PATH for all users
```

4. éªŒè¯å®‰è£…ï¼ˆæ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼‰ï¼š
```cmd
cmake --version
```
åº”æ˜¾ç¤ºç±»ä¼¼ï¼š`cmake version 3.28.x`

### 1.3 å®‰è£… Gitï¼ˆå¯é€‰ä½†æ¨èï¼‰

1. è®¿é—® [Git å®˜ç½‘](https://git-scm.com/download/win)
2. ä¸‹è½½å¹¶å®‰è£… 64-bit Git for Windows
3. å®‰è£…æ—¶ä¿æŒé»˜è®¤é€‰é¡¹å³å¯

---

## 2. ä¸‹è½½æºç 

### 2.1 åˆ›å»ºå·¥ä½œç›®å½•

æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆ**ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œéœ€è¦è¿™æ ·åš**ï¼‰ï¼Œæ‰§è¡Œï¼š

```cmd
:: åˆ›å»º OpenCV å·¥ä½œç›®å½•
mkdir C:\opencv
cd C:\opencv
```

### 2.2 ä¸‹è½½ OpenCV æºç 

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Git å…‹éš†ï¼ˆæ¨èï¼‰**

```cmd
:: å…‹éš† OpenCV ä¸»ä»“åº“
git clone https://github.com/opencv/opencv.git

:: å…‹éš† OpenCV æ‰©å±•æ¨¡å—
git clone https://github.com/opencv/opencv_contrib.git
```

### 2.3 åˆ›å»ºæ„å»ºç›®å½•

```cmd
cd C:\opencv
mkdir build
```

**æ­¤æ—¶ç›®å½•ç»“æ„åº”ä¸ºï¼š**
```
C:\opencv\
â”œâ”€â”€ opencv\           # OpenCV æºç 
â”œâ”€â”€ opencv_contrib\   # æ‰©å±•æ¨¡å—æºç 
â””â”€â”€ build\            # æ„å»ºè¾“å‡ºç›®å½•
```

---

## 3. CMake å‘½ä»¤è¡Œé…ç½®

### 3.1 æ‰“å¼€å¼€å‘è€…å‘½ä»¤æç¤ºç¬¦

æŒ‰ `Win + S` æœç´¢å¹¶æ‰“å¼€ï¼š
```
x64 Native Tools Command Prompt for VS 2022
```

> âš ï¸ **é‡è¦**ï¼š**åŒå­¦ä»¬æ³¨æ„ï¼Œå¿…é¡»ä½¿ç”¨æ­¤å‘½ä»¤æç¤ºç¬¦**

### 3.2 è¿›å…¥æ„å»ºç›®å½•

```cmd
cd C:\opencv\build
```

### 3.3 é…ç½®ï¼ˆæ— NVIDIAæ˜¾å¡ï¼‰

å¦‚æœä¸‹è½½äº† `opencv_contrib`ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```cmd
cmake -G "Visual Studio 17 2022" -A x64 ^
    -DCMAKE_INSTALL_PREFIX=D:/Projects/DeepBule/C++Project/opencv/install ^
    -DCMAKE_BUILD_TYPE=Release ^
    -DBUILD_EXAMPLES=ON ^
    -DBUILD_opencv_world=ON ^
    -DBUILD_TESTS=OFF ^
    -DBUILD_PERF_TESTS=OFF ^
    -DBUILD_DOCS=OFF ^
    -DWITH_OPENGL=ON ^
    -DWITH_FFMPEG=ON ^
    -DOPENCV_EXTRA_MODULES_PATH=D:/Projects/DeepBule/C++Project/opencv/opencv_contrib/modules ^
    ../opencv
```

### 3.5 å®Œæ•´é…ç½®(å·¥ä¸šçº§å¯ç”¨ CUDA æ”¯æŒï¼‰ï¼ˆéœ€è¦ NVIDIA æ˜¾å¡ï¼‰

```cmd
cmake -G "Visual Studio 17 2022" -A x64 ^
    -DCMAKE_INSTALL_PREFIX=D:/Projects/DeepBule/C++Project/opencv/install ^
    -DCMAKE_BUILD_TYPE=Release ^
    -DBUILD_EXAMPLES=ON ^
    -DBUILD_opencv_world=ON ^
    -DBUILD_TESTS=ON ^
    -DBUILD_PERF_TESTS=ON ^
    -DBUILD_DOCS=ON ^
    -DWITH_OPENGL=ON ^
    -DWITH_FFMPEG=ON ^
    -DWITH_CUDA=ON ^
    -DOPENCV_DNN_CUDA=ON ^
    -DCUDA_ARCH_BIN="8.6" ^
    -DOPENCV_EXTRA_MODULES_PATH=D:/Projects/DeepBule/C++Project/opencv/opencv_contrib/modules ^
    ../opencv
   
    
cmake -G "Visual Studio 17 2022" -A x64 -DCMAKE_INSTALL_PREFIX=C:/opencv/install -DCMAKE_BUILD_TYPE=Release -DBUILD_EXAMPLES=ON -DBUILD_opencv_world=ON -DBUILD_TESTS=ON -DBUILD_PERF_TESTS=ON -DBUILD_DOCS=ON -DWITH_OPENGL=ON -DWITH_FFMPEG=ON -DWITH_CUDA=ON -DOPENCV_DNN_CUDA=ON -DCUDA_ARCH_BIN="8.6" -DOPENCV_EXTRA_MODULES_PATH=C:/opencv/opencv_contrib/modules ../opencv
```

> ğŸ’¡ `CUDA_ARCH_BIN` æ ¹æ®æ˜¾å¡å‹å·è®¾ç½®ï¼š**RTX 30ç³»åˆ—ç”¨ "8.6"ï¼ŒRTX 40ç³»åˆ—ç”¨ "8.9"**

### 3.6 é…ç½®æˆåŠŸè¾“å‡º

é…ç½®æˆåŠŸåï¼Œåº”çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
-- General configuration for OpenCV 4.9.0 =====================================
--   Version control:               4.9.0
--
--   Platform:
--     Timestamp:                   2024-xx-xx
--     Host:                        Windows 10.0.22631 AMD64
--     CMake:                       3.28.x
--     CMake generator:             Visual Studio 17 2022
--     CMake build tool:            C:/Program Files/Microsoft Visual Studio/2022/...
--     MSVC:                        1939
--
--   CPU/HW features:
--     Baseline:                    SSE SSE2 SSE3
--     Dispatched code generation:  SSE4_1 SSE4_2 AVX AVX2 ...
--
--   C/C++:
--     Built as dynamic libs?:      YES
--     C++ standard:                11
--     ...
--
--   OpenCV modules:
--     To be built:                 core imgproc imgcodecs ... world
--     Disabled:                    ...
--     ...
--
-- Configuring done
-- Generating done
-- Build files have been written to: C:/opencv/build
```

## 4. ç¼–è¯‘ä¸å®‰è£…

### 4.1 ä½¿ç”¨å‘½ä»¤è¡Œç¼–è¯‘

åœ¨ **x64 Native Tools Command Prompt for VS 2022** ä¸­æ‰§è¡Œï¼š

```cmd
cd C:\opencv\build

:: ç¼–è¯‘ Release ç‰ˆæœ¬
cmake --build . --config Release

:: å®‰è£… Release ç‰ˆæœ¬
cmake --build . --config Release --target INSTALL
```

### 4.2 éªŒè¯ç¼–è¯‘ç»“æœ

ç¼–è¯‘å®‰è£…å®Œæˆåï¼Œæ£€æŸ¥å®‰è£…ç›®å½•ï¼š

```cmd
dir C:\opencv\install\x64\vc17\bin\*.dll
dir C:\opencv\install\x64\vc17\lib\*.lib
dir C:\opencv\install\include\opencv2
```

é¢„æœŸç›®å½•ç»“æ„ï¼š
```
C:\opencv\install\
â”œâ”€â”€ include\
â”‚   â””â”€â”€ opencv2\         # å¤´æ–‡ä»¶
â”œâ”€â”€ x64\
â”‚   â””â”€â”€ vc17\
â”‚       â”œâ”€â”€ bin\         # DLL åŠ¨æ€åº“
â”‚       â”‚   â”œâ”€â”€ opencv_world490.dll      (Release)
â”‚       â””â”€â”€ lib\         # LIB å¯¼å…¥åº“
â”‚           â”œâ”€â”€ opencv_world490.lib      (Release)
â””â”€â”€ etc\                 # é…ç½®æ–‡ä»¶ï¼ˆHaar çº§è”ç­‰ï¼‰
```

---

## 5. ç¯å¢ƒå˜é‡é…ç½®

### 5.1 ä½¿ç”¨å‘½ä»¤è¡Œè®¾ç½®ï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰

æ‰“å¼€ **ç®¡ç†å‘˜å‘½ä»¤æç¤ºç¬¦**ï¼š

```cmd
:: è®¾ç½® OPENCV_DIR ç¯å¢ƒå˜é‡
setx OPENCV_DIR "C:\opencv\install" /M

:: æ·»åŠ  DLL è·¯å¾„åˆ° PATH
setx PATH "%PATH%;C:\opencv\install\x64\vc17\bin" /M

```

### 5.3 éªŒè¯ç¯å¢ƒå˜é‡

**é‡æ–°æ‰“å¼€** ä¸€ä¸ªæ–°çš„å‘½ä»¤æç¤ºç¬¦çª—å£ï¼š

```cmd
:: éªŒè¯ OPENCV_DIR
echo %OPENCV_DIR%
:: åº”è¾“å‡º: C:\opencv\install

:: éªŒè¯ DLL å¯è®¿é—®
where opencv_world4120d.dll

:: åº”è¾“å‡º: C:\opencv\install\x64\vc17\bin\opencv_world490.dll
```

---

## 6. éªŒè¯å®‰è£…

### 6.1 åˆ›å»ºæµ‹è¯•é¡¹ç›®æ–‡ä»¶å¤¹

```cmd
mkdir C:\opencv_test
cd C:\opencv_test
```

### 6.2 åˆ›å»ºæµ‹è¯•æºæ–‡ä»¶

åˆ›å»ºæ–‡ä»¶ `test_opencv.cpp`ï¼š

```cpp
#include <opencv2/opencv.hpp>
#include <iostream>

int main() {
    // æ‰“å° OpenCV ç‰ˆæœ¬
    std::cout << "================================" << std::endl;
    std::cout << "OpenCV Version: " << CV_VERSION << std::endl;
    std::cout << "================================" << std::endl;
    
    // åˆ›å»ºä¸€ä¸ª 500x500 çš„å½©è‰²å›¾åƒï¼ˆè“è‰²èƒŒæ™¯ï¼‰
    cv::Mat image(500, 500, CV_8UC3, cv::Scalar(255, 100, 0));
    
    // åœ¨å›¾åƒä¸Šç»˜åˆ¶æ–‡æœ¬
    cv::putText(image, 
                "OpenCV Works!", 
                cv::Point(100, 250),
                cv::FONT_HERSHEY_SIMPLEX, 
                1.5, 
                cv::Scalar(255, 255, 255),
                3);
    
    // ç»˜åˆ¶ä¸€ä¸ªåœ†
    cv::circle(image, cv::Point(250, 350), 80, cv::Scalar(0, 255, 0), -1);
    
    // ç»˜åˆ¶çŸ©å½¢
    cv::rectangle(image, cv::Point(50, 50), cv::Point(150, 150), 
                  cv::Scalar(0, 0, 255), 3);
    
    // æ˜¾ç¤ºå›¾åƒ
    cv::imshow("OpenCV Test", image);
    
    std::cout << "Image created successfully!" << std::endl;
    std::cout << "Press any key to close..." << std::endl;
    
    cv::waitKey(0);
    
    // ä¿å­˜å›¾åƒ
    cv::imwrite("test_output.png", image);
    std::cout << "Image saved as test_output.png" << std::endl;
    
    return 0;
}
```

### 6.3 åˆ›å»º CMakeLists.txt

åˆ›å»ºæ–‡ä»¶ `CMakeLists.txt`ï¼š

```cmake
cmake_minimum_required(VERSION 3.20)
project(OpenCV_Test)

# è®¾ç½® C++ æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# æŸ¥æ‰¾ OpenCV
find_package(OpenCV REQUIRED)

# æ‰“å° OpenCV ä¿¡æ¯
message(STATUS "=================================")
message(STATUS "OpenCV version: ${OpenCV_VERSION}")
message(STATUS "OpenCV include dirs: ${OpenCV_INCLUDE_DIRS}")
message(STATUS "OpenCV libraries: ${OpenCV_LIBS}")
message(STATUS "=================================")

# åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶
add_executable(test_opencv test_opencv.cpp)

# é“¾æ¥ OpenCV åº“
target_link_libraries(test_opencv ${OpenCV_LIBS})
```

### 6.4 ä½¿ç”¨ CMake æ„å»ºæµ‹è¯•é¡¹ç›®

åœ¨ **x64 Native Tools Command Prompt for VS 2022** ä¸­æ‰§è¡Œï¼š

```cmd
cd C:\opencv_test

:: åˆ›å»ºæ„å»ºç›®å½•
mkdir build
cd build

:: é…ç½®é¡¹ç›®
cmake -G "Visual Studio 17 2022" -A x64 ^
      -DOpenCV_DIR=C:/opencv/install ^
      ..

:: ç¼–è¯‘ Release ç‰ˆæœ¬
cmake --build . --config Release

:: è¿è¡Œæµ‹è¯•ç¨‹åº
Release\test_opencv.exe
```

### 6.5 é¢„æœŸç»“æœ

ç¨‹åºè¿è¡Œååº”ï¼š
1. æ§åˆ¶å°è¾“å‡º OpenCV ç‰ˆæœ¬å·
2. å¼¹å‡ºçª—å£æ˜¾ç¤ºè“è‰²èƒŒæ™¯å›¾åƒï¼Œå¸¦æœ‰ "OpenCV Works!" æ–‡å­—ã€ç»¿è‰²åœ†å½¢å’Œçº¢è‰²çŸ©å½¢
3. æŒ‰ä»»æ„é”®åçª—å£å…³é—­
4. åœ¨ `build\Release\` ç›®å½•ç”Ÿæˆ `test_output.png` æ–‡ä»¶

---

