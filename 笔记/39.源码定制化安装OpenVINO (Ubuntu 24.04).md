

# 源码定制化安装OpenVINO (Ubuntu 24.04)

## 一、Linux环境



1) 安装基础依赖
- 编译工具链、CMake、Ninja（更快）、Python、USB/GTK 等常用依赖：
```bash
sudo apt update
sudo apt upgrade

sudo apt install -y git cmake build-essential ninja-build ccache pkg-config \
                    python3 python3-venv python3-dev python3-pip \
                    libusb-1.0-0-dev libgtk-3-dev wget unzip clinfo libprotobuf-dev patchelf
```

2. Python 虚拟环境

```bash
python3 -m venv ~/ov-env
source ~/ov-env/bin/activate
python3 -m pip install -U pip setuptools wheel packaging
```

3. 获取 OpenVINO 源码

```bash
git clone --recursive https://github.com/openvinotoolkit/openvino.git
cd openvino
git fetch --tags
LATEST_2024=$(git tag -l "2024.*" | sort -V | tail -n1)
git checkout -B build-${LATEST_2024:-master} ${LATEST_2024:-master}
git submodule update --init --recursive
```

4. 配置构建选项

```bash
cd openvino
rm -rf build

cmake -S . -B build \
  -DCMAKE_BUILD_TYPE=Release \
  -DENABLE_INTEL_CPU=ON \
  -DENABLE_INTEL_GPU=OFF \
  -DENABLE_INTEL_GNA=OFF \
  -DENABLE_MYRIAD=OFF \
  -DENABLE_AUTO=OFF \
  -DENABLE_MULTI=OFF \
  -DENABLE_HETERO=OFF \
  -DENABLE_TEMPLATE=ON \
  -DENABLE_SAMPLES=ON \
  -DENABLE_TOOLS=ON \
  -DENABLE_PYTHON=ON \
  -DENABLE_WHEEL=ON \
  -DENABLE_TESTS=OFF \
  -DENABLE_CPPLINT=OFF \
  -DPYTHON_EXECUTABLE=$(which python)
```
- 说明：
  - 有时 Python 轮子不会默认打包成 whl，可在构建完成后执行 target 帮助查看 wheel 目标：
    - cmake --build build --target help | grep -i wheel
    - 找到目标名后：cmake --build build --target <wheel_target>

5. 编译

```bash
cmake --build build --parallel
```

6. 安装

```bash
sudo cmake --install build --prefix /opt/openvino
```

7. 环境变量

```bash
# 安装完成通常会有
source /opt/openvino/setupvars.sh
# 若找不到，可手工设置（不同版本目录略有变动，下方是常见路径）：
# export OPENVINO_DIR=/opt/openvino
# export LD_LIBRARY_PATH=$OPENVINO_DIR/runtime/lib/intel64:$LD_LIBRARY_PATH
# export PATH=$OPENVINO_DIR/tools:$OPENVINO_DIR/samples_bin:$PATH
```

8. Python 包

- 若构建产物中生成了 Python 轮子（build/wheels/openvino-*.whl），直接安装：
```bash
pip install build/wheels/openvino-*.whl
```
- 备注：模型转换工具 ovc 属 Python 工具，课堂演示可直接用 runtime 读取 ONNX 不经转换；若需 ovc，可单独 pip 安装 openvino-dev（版本需尽量与源码接近）。

9. 验证

- 列出可用设备：
```bash
/opt/openvino/samples_bin/hello_query_device
```
- 准备一个小模型（SqueezeNet ONNX）并跑基准：
```bash
cd ~
wget -O squeezenet1.1.onnx https://github.com/onnx/models/raw/main/vision/classification/squeezenet/model/squeezenet1.1.onnx

# CPU
/opt/openvino/tools/benchmark/benchmark_app -m ~/squeezenet1.1.onnx -d CPU -api sync -niter 50

```
- Python 快速验证：
```python
# 保存为 quick_test.py
import numpy as np
import openvino as ov

core = ov.Core()
print("Available devices:", core.get_available_devices())

model = core.read_model("squeezenet1.1.onnx")
compiled = core.compile_model(model, "CPU")  # 或 "GPU"
input_tensor = np.random.rand(1,3,224,224).astype(np.float32)

infer_req = compiled.create_infer_request()
infer_req.set_input_tensor(input_tensor)
infer_req.infer()
out = infer_req.get_output_tensor(0).data
print("Output shape:", out.shape)
```
```bash
python quick_test.py
```
